version: "3"

tasks:
  default:
    desc: List all available tasks
    cmds:
      - task --list
    silent: true

  help:
    desc: Show detailed help for all tasks
    silent: true
    cmds:
      - |
        cat << 'EOF'

        ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        ‚ïë           üìö Elastic RAG - Task Runner Help                        ‚ïë
        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

        üèóÔ∏è  BUILD & SETUP
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task setup          Create .env file from example
          task install        Install/update dependencies with uv
          task update         Update all dependencies
          task build          Build Docker images
          task build:no-cache Build Docker images without cache (clean build)

        üöÄ SERVICES
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task start          Start all services (Elasticsearch + App)
          task stop           Stop all services
          task restart        Restart all services
          task dev            Start development server with hot reload
          task ps             Show running services
          task health         Check health of all services

        üìã LOGS
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task logs           View all service logs
          task logs-app       View app service logs only
          task logs-es        View Elasticsearch logs only

        üß™ TESTING
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task test           Run full test suite with coverage
          task test-unit      Run unit tests only
          task test-integration Run integration tests only
          task test-e2e       Run end-to-end tests only

        ‚ú® CODE QUALITY
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task lint           Run linting checks (ruff + black)
          task format         Auto-format code with black and ruff
          task type-check     Run mypy type checking
          task pre-commit     Run pre-commit hooks on all files
          task pre-commit-install  Install pre-commit git hooks

        üé¨ DEMOS
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task demo-phase3    Phase 3 demo (Document Processing)
          task demo-phase4    Phase 4 demo (Elasticsearch Integration)
          task demo-phase5    Phase 5 demo (RAG Agent with Google ADK)
          task demo-phase6    Phase 6 demo (Resilience Layer)
          task demo-phase7    Phase 7 demo (API Layer)
          task demo-all       Run all demos sequentially

        üîç VERIFICATION & HEALTH (v1.0.1+)
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task demo-verify    Upload verification demo (best practices)
          task demo-health    System health check demo
          task verify         Quick system health check

        üñ•Ô∏è  WEB UI (Phase 10)
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task ui:dev         Start Gradio UI in development mode
          task ui:start       Start Gradio UI (production mode)

        üßπ MAINTENANCE
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          task clean          Clean up Docker resources and Python cache
          task shell          Open shell in app container

        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        üí° TIP: Run 'task --list' for a quick list of all tasks

        EOF

  build:
    desc: Build Docker images
    cmds:
      - docker compose -f docker/docker-compose.yml build
      - echo "‚úÖ Docker images built successfully"

  build:no-cache:
    desc: Build Docker images without cache (clean build)
    cmds:
      - docker compose -f docker/docker-compose.yml build --no-cache
      - echo "‚úÖ Docker images built successfully (no cache)"

  start:
    desc: Start all services (Elasticsearch + App)
    cmds:
      - docker compose -f docker/docker-compose.yml up -d
      - echo "Services started successfully!"

  stop:
    desc: Stop all services
    cmds:
      - docker compose -f docker/docker-compose.yml down
      - echo "üõë Services stopped"

  restart:
    desc: Restart all services
    cmds:
      - task: stop
      - task: start

  dev:
    desc: Start in development mode with hot reload (local, not Docker)
    cmds:
      - echo "üîß Starting development server..."
      - uv run uvicorn src.main:app --reload --host 0.0.0.0 --port 8000

  test:
    desc: Run test suite
    cmds:
      - uv run pytest tests/ -v --cov=src --cov-report=term-missing
      - echo "‚úÖ Tests completed"

  test-unit:
    desc: Run unit tests only
    cmds:
      - uv run pytest tests/unit/ -v

  test-integration:
    desc: Run integration tests only
    cmds:
      - uv run pytest tests/integration/ -v

  test-e2e:
    desc: Run end-to-end tests only
    cmds:
      - uv run pytest tests/e2e/ -v

  lint:
    desc: Run linting checks
    cmds:
      - uv run ruff check src/ tests/
      - uv run black --check src/ tests/
      - echo "‚úÖ Linting passed"

  format:
    desc: Format code with black and ruff
    cmds:
      - uv run ruff check --fix src/ tests/
      - uv run black src/ tests/
      - echo "‚úÖ Code formatted"

  type-check:
    desc: Run type checking with mypy
    cmds:
      - uv run mypy src/
      - echo "‚úÖ Type checking passed"

  pre-commit:
    desc: Run pre-commit hooks on all files
    cmds:
      - uv run pre-commit run --all-files
      - echo "‚úÖ Pre-commit checks passed"

  pre-commit-install:
    desc: Install pre-commit git hooks
    cmds:
      - uv run pre-commit install
      - echo "‚úÖ Pre-commit hooks installed"

  clean:
    desc: Clean up Docker resources and Python cache
    cmds:
      - docker compose -f docker/docker-compose.yml down -v
      - docker system prune -f
      - find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
      - find . -type f -name "*.pyc" -delete 2>/dev/null || true
      - rm -rf .pytest_cache .coverage htmlcov .mypy_cache
      - echo "üßπ Cleaned up successfully"

  logs:
    desc: View service logs
    cmds:
      - docker compose -f docker/docker-compose.yml logs -f

  logs-app:
    desc: View app service logs only
    cmds:
      - docker compose -f docker/docker-compose.yml logs -f app

  logs-es:
    desc: View Elasticsearch logs only
    cmds:
      - docker compose -f docker/docker-compose.yml logs -f elasticsearch

  ps:
    desc: Show running services
    cmds:
      - docker compose -f docker/docker-compose.yml ps

  shell:
    desc: Open shell in app container
    cmds:
      - docker compose -f docker/docker-compose.yml exec app /bin/bash

  health:
    desc: Check health of all services
    cmds:
      - echo "üîç Checking service health..."
      - echo "\nüìç App Health:"
      - curl -s http://localhost:8000/health | python -m json.tool || echo "‚ùå App not responding"
      - echo "\nüìç Elasticsearch Health:"
      - curl -s http://localhost:9200/_cluster/health | python -m json.tool || echo "‚ùå Elasticsearch not responding"

  setup:
    desc: Initial setup - create .env from example
    cmds:
      - |
        if [ ! -f .env ]; then
          cp .env.example .env
          echo "‚úÖ Created .env file from .env.example"
          echo "‚ö†Ô∏è  Please review and update .env with your configuration"
        else
          echo "‚ÑπÔ∏è  .env file already exists"
        fi

  install:
    desc: Install/update dependencies
    cmds:
      - uv sync
      - echo "‚úÖ Dependencies installed"

  update:
    desc: Update dependencies
    cmds:
      - uv sync --upgrade
      - echo "‚úÖ Dependencies updated"

  demo-phase3:
    desc: Run Phase 3 demo (Document Processing Pipeline)
    cmds:
      - echo "üé¨ Running Phase 3 Demo..."
      - uv run python demos/demo_phase3.py

  demo-phase4:
    desc: Run Phase 4 demo (Elasticsearch Integration)
    cmds:
      - echo "üé¨ Running Phase 4 Demo..."
      - uv run python demos/demo_phase4.py

  demo-phase5:
    desc: Run Phase 5 demo (RAG Agent with Google ADK)
    cmds:
      - echo "üé¨ Running Phase 5 Demo..."
      - uv run python demos/demo_phase5.py

  demo-phase6:
    desc: Run Phase 6 demo (Resilience Layer)
    cmds:
      - echo "üé¨ Running Phase 6 Demo..."
      - echo "‚ÑπÔ∏è  Demo adapts based on available services (ES, LMStudio)"
      - uv run python demos/demo_phase6.py

  demo-phase7:
    desc: Run Phase 7 demo (API Layer)
    cmds:
      - echo "üé¨ Running Phase 7 Demo..."
      - echo "‚ÑπÔ∏è  Make sure services are running (task start)"
      - uv run python demos/demo_phase7.py

  demo-all:
    desc: Run all demo scripts sequentially
    cmds:
      - echo "üé¨ Running all demos..."
      - echo ""
      - task: demo-phase3
      - echo ""
      - echo "‚è≥ Waiting 2 seconds before next demo..."
      - sleep 2
      - task: demo-phase4
      - echo ""
      - echo "‚è≥ Waiting 2 seconds before next demo..."
      - sleep 2
      - task: demo-phase5
      - echo ""
      - echo "‚è≥ Waiting 2 seconds before next demo..."
      - sleep 2
      - task: demo-phase6
      - echo ""
      - echo "‚è≥ Waiting 2 seconds before next demo..."
      - sleep 2
      - task: demo-phase7
      - echo ""
      - echo "‚úÖ All demos completed!"

  demo-verify:
    desc: Run upload verification demo (v1.0.1+)
    cmds:
      - echo "üîç Running Upload Verification Demo..."
      - echo "‚ÑπÔ∏è  Demonstrates proper upload ‚Üí verify ‚Üí query workflow"
      - echo "‚ÑπÔ∏è  Make sure services are running (task start)"
      - uv run python demos/demo_upload_verification.py

  demo-health:
    desc: Run system health check demo
    cmds:
      - echo "üè• Running System Health Check Demo..."
      - echo "‚ÑπÔ∏è  Comprehensive health check for all components"
      - uv run python demos/demo_system_health.py

  verify:
    desc: Quick system health check (alias for demo-health)
    cmds:
      - task: demo-health

  ui:dev:
    desc: Start Gradio UI in development mode
    cmds:
      - echo "üñ•Ô∏è  Starting Gradio UI..."
      - echo "‚ÑπÔ∏è  UI will be available at http://localhost:7860"
      - echo "‚ÑπÔ∏è  API backend should be running at http://localhost:8000"
      - uv run python demos/launch_ui.py

  ui:start:
    desc: Start Gradio UI (production mode)
    cmds:
      - echo "üñ•Ô∏è  Starting Gradio UI in production mode..."
      - echo "‚ÑπÔ∏è  UI will be available at http://0.0.0.0:7860"
      - echo "‚ÑπÔ∏è  API backend should be running at http://localhost:8000"
      - uv run python demos/launch_ui.py --host 0.0.0.0 --share false
